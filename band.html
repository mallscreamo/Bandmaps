<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Band Details - Bandmaps</title>
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      font-weight: 700;
      margin-bottom: 10px;
      letter-spacing: 1px;
    }
    .band-photo {
      max-width: 100%;
      max-height: 350px;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .field-label {
      font-weight: 700;
      margin-top: 15px;
      color: #bbb;
    }
    a {
      color: #8ab4f8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    #loading {
      text-align: center;
      font-size: 18px;
      margin-top: 40px;
    }
    #notFound {
      text-align: center;
      font-size: 20px;
      margin-top: 60px;
      color: #f55;
    }
    .bio {
      margin-top: 10px;
      font-style: italic;
      color: #ccc;
      white-space: pre-wrap;
    }
    .links a {
      display: block;
      margin-top: 6px;
      font-weight: 600;
    }
    a.back-link {
      display: block;
      margin: 30px 0 0;
      color: #aaa;
      text-decoration: none;
      font-size: 14px;
    }
    a.back-link:hover {
      color: #fff;
    }
  </style>
</head>
<body>
  <div id="content">
    <div id="loading">Loading band info...</div>
  </div>
  <a href="index.html" class="back-link">Back to Map</a>

  <script>
    const SHEET_JSON_URL = 'https://api.sheetbest.com/sheets/3747de06-5460-4172-b3db-5d60c6021cd4';

    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    async function fetchBands() {
      try {
        const res = await fetch(SHEET_JSON_URL);
        if (!res.ok) throw new Error('Failed to fetch bands');
        return await res.json();
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function createLink(name, url) {
      if (!url) return '';
      return `<a href="${url}" target="_blank" rel="noopener noreferrer">${name}</a>`;
    }

    function sanitize(str) {
      if (!str) return '';
      return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    (async () => {
      const bandName = getQueryParam('name');
      const contentDiv = document.getElementById('content');

      if (!bandName) {
        contentDiv.innerHTML = '<div id="notFound">No band specified.</div>';
        return;
      }

      contentDiv.innerHTML = '<div id="loading">Loading band info...</div>';

      const bands = await fetchBands();

      const band = bands.find((b) => b.Name === bandName);

      if (!band) {
        contentDiv.innerHTML = `<div id="notFound">Band "${sanitize(
          bandName
        )}" not found.</div>`;
        return;
      }

      const photoHTML = band.PhotoURL
        ? `<img src="${sanitize(band.PhotoURL)}" alt="Photo of ${sanitize(
            band.Name
          )}" class="band-photo" />`
        : '';

      contentDiv.innerHTML = `
        ${photoHTML}
        <h1>${sanitize(band.Name)}</h1>
        <div><span class="field-label">Genre:</span> ${sanitize(band.Genre)}</div>
        <div><span class="field-label">City:</span> ${sanitize(band.City)}</div>
        <div><span class="field-label">Country:</span> ${sanitize(band.Country)}</div>
        <div><span class="field-label">Latitude:</span> ${sanitize(band.Latitude)}</div>
        <div><span class="field-label">Longitude:</span> ${sanitize(band.Longitude)}</div>
        <div><span class="field-label">Bio:</span> <p class="bio">${sanitize(band.Bio)}</p></div>
        <div class="links">
          ${createLink('Spotify', band.Spotify)}
          ${createLink('Apple Music', band['Apple Music'] || band.AppleMusic)}
          ${createLink('YouTube', band.Youtube)}
          ${createLink('Instagram', band.Instagram)}
          ${createLink('TikTok', band.Tiktok)}
          ${createLink('X (Twitter)', band.X)}
          ${createLink('Bandcamp', band.Bandcamp)}
        </div>
      `;
    })();
  </script>
</body>
</html>
